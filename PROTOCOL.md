## 帧协议说明

### 协议格式

所有命令的格式为：`<HEXDATA>`

- `<` - 帧开始标记
- `>` - 帧结束标记
- `HEXDATA` - 16进制数据，每个字节用两个16进制字符表示

### 命令结构

根据第一个字节（命令类型）确定整个命令的长度：

#### 0x01 - 颜色设置（3字节）
格式：`<01 ColorType Param>`

**长度判断**：读到 0x01 就知道这个命令总长度是 3 字节，后续需要接收 4 个 HEX 字符（02+04=06字符）

颜色类型：
- `00` - 黑色 (OFF)
- `01` - 红色
- `02` - 绿色
- `03` - 蓝色
- `04` - 白色
- `05` - 黄色
- `06` - 青色
- `07` - 品红色

**示例**：
- `<010100>` - 红色
- `<010200>` - 绿色
- `<010300>` - 蓝色

---

#### 0x02 - 动画模式设置（4字节）
格式：`<02 ModeType SpeedValue Reserved>`

模式类型：
- `01` - 彩虹渐变
- `02` - 脉冲
- `03` - 波浪
- `04` - 频闪
- `05` - 闪烁
- `06` - 火焰
- `07` - 追逐
- `08` - 彩色循环

SpeedValue: 0x00-0x64 (0-100%, 动画速度)
Reserved: 0x00 (预留)

**示例**：
- `<02010A00>` - 彩虹模式，速度 10%
- `<02013200>` - 彩虹模式，速度 50%
- `<0201FF00>` - 彩虹模式，速度 100%
- `<020200FF>` - 脉冲模式，速度 100%

---

#### 0x03 - 参数设置（5字节）
格式：`<03 ParamType ValueHigh ValueLow Extra>`

参数类型：
- `01` - 亮度 (0-255)
- `02` - 速度 (0-100%)

ValueHigh, ValueLow: 16位大端值 (High Byte, Low Byte)
Extra: 额外数据，通常填 0x00

**示例**：
- `<0301007F00>` - 设置亮度为 127 (0x7F)
- `<0302003200>` - 设置速度为 50%
- `<03010000FF>` - 设置亮度为 255

---

#### 0x04 - 自定义RGB值（6字节）
格式：`<04 RedValue GreenValue BlueValue BrightnessValue Reserved>`

RedValue: 0x00-0xFF
GreenValue: 0x00-0xFF
BlueValue: 0x00-0xFF
BrightnessValue: 0x00-0xFF
Reserved: 0x00

**示例**：
- `<04FF0000FF00>` - 纯红色，亮度 255
- `<0400FF00FF00>` - 纯绿色，亮度 255
- `<040000FFFF00>` - 纯蓝色，亮度 255
- `<04FF00FF8000>` - 紫色，亮度 128

---

#### 0xFF - 系统命令（2字节）
格式：`<FF SystemCmd>`

系统命令：
- `00` - 关闭所有LED
- `01` - 显示帮助菜单
- `02` - 查询设备状态

**示例**：
- `<FF00>` - 关闭LED
- `<FF01>` - 显示菜单
- `<FF02>` - 查询状态

---

### 错误处理

如果收到的数据格式不正确，会被丢弃：

1. **不以 `<` 开头或以 `>` 结尾** - 忽略
2. **HEX字符不合法** - 丢弃，并打印错误信息
3. **长度不匹配** - 例如 `<0101>` (缺少字节) - 丢弃
4. **缓冲区溢出** - 缓冲区大小为 128 字节

### 使用示例

**通过串口**：
```
<010100>  # 设置红色
<020132FF>  # 彩虹模式
<0301007F00>  # 亮度设置为127
```

**通过蓝牙**：
同样的命令格式可以通过蓝牙发送

### 命令长度表

| 命令类型 | 十六进制 | 长度（字节） | 格式 |
|---------|--------|----------|------|
| 颜色    | 0x01   | 3        | <01 ColorType Param> |
| 模式    | 0x02   | 4        | <02 ModeType Hue Speed> |
| 参数    | 0x03   | 5        | <03 ParamType ValHi ValLo Extra> |
| RGB     | 0x04   | 6        | <04 R G B Brightness Reserved> |
| 系统    | 0xFF   | 2        | <FF SysCmd> |

